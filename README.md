# HW3: Система Антиплагиата на Микросервисах 

**Автор** Загоруйко Даниил Александрович

**Проект:** КПО ДЗ‑3. Синхронное межсервисное взаимодействие. Антиплагиат.

Данный проект реализует минимально жизнеспособный продукт (MVP) информационной системы для приема студенческих работ, их хранения и синхронной проверки на признаки заимствования. Архитектура построена на микросервисах с использованием Spring Boot 3 и Docker.

---

## 1. Архитектура системы

Система состоит из трех микросервисов и двух изолированных баз данных PostgreSQL, развернутых через Docker Compose.

| Сервис | Роль | Технологии | Порт |
| :--- | :--- | :--- | :--- |
| **API Gateway** | Центральный посредник. Маршрутизация запросов. | Spring Cloud Gateway (WebFlux) | 8080 |
| **File Storing Service (FSS)** | Хранение метаданных (`work_metadata`), хешей и файлов, управление статусами. | Spring Boot (JPA), PostgreSQL | 8081 |
| **File Analysis Service (FAS)** | Проведение анализа, хранение отчетов (`analysis_reports`) и кеша хешей (`WorkData`). | Spring Boot (JPA), PostgreSQL | 8082 |

### Технические сценарии обмена данными

1.  **Сдача работы (POST /submit):** Gateway направляет запрос на FSS. FSS сохраняет метаданные и файл.
2.  **Синхронный вызов FAS:** FSS вычисляет SHA-256 хеш файла, меняет статус на `ANALYZING` и **синхронно** вызывает FAS, передавая ID и хеш.
3.  **Обработка FAS:** FAS выполняет проверку по хешу и сохраняет отчет в своей базе данных.
4.  **Обработка сбоя:** Если FAS недоступен, FSS ловит исключение, устанавливает статус работы как **`FAILED`** и возвращает клиенту ошибку `503 Service Unavailable`, демонстрируя отказоустойчивость.
5.  **Выдача отчета (GET /reports):** Gateway направляет запрос на FAS, который возвращает результат из базы данных.

---

## 2. Сборка, Запуск и Демонстрация

### 2.1 Команда запуска всей системы

Перейдите в корневую папку `HW3/` и выполните команду:

```bash
docker compose up --build -d
````

### 2.2 Демонстрация API (cURL и Swagger)

#### A. Сдача работы (POST /api/v1/submit)

```bash
# 1. Создаем тестовый файл
echo "Demo content for antiplagiat check" > test.txt
```

```bash
# 2. Отправляем работу. (Возвращает ID работы)
curl -X POST http://localhost:8080/api/v1/submit \
  -F "submitterName=Final User" \
  -F "assignmentName=HW3" \
  -F "file=@test.txt"
```

#### B. Получение отчета (GET /api/v1/works/{workId}/reports)

```bash
# Используйте ID, который вернулся выше.
curl http://localhost:8080/api/v1/works/7/reports
# Результат: Полный JSON с antiplagiatScore и wordCloudUrl.
```

### 2.3 Доступ к Swagger UI

Функциональность API также может быть проверена через Swagger UI (SpringDoc):

  * **File Storing Service (FSS):** `http://localhost:8081/swagger-ui.html`
  * **File Analysis Service (FAS):** `http://localhost:8082/swagger-ui.html`

-----

## 3\. Алгоритм и Визуализация

### 3.1 Алгоритм антиплагиата

Реализован **детерминированный алгоритм хеширования (SHA-256)**.

  * Если **хеш найден** в базе данных FAS (повторная сдача того же файла), работа помечается как плагиат (`plagiarism: true`) с низким баллом (15-25%).
  * Если **хеш не найден**, работа помечается как оригинальная.

### 3.2 Визуализация (Облако Слов)

FAS генерирует прямую ссылку (`wordCloudUrl`) на внешний API (QuickChart), которая визуализирует облако слов на основе содержимого работы.
